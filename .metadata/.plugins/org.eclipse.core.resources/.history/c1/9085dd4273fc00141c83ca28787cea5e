package com.geertenvink.Bardiche;

import java.io.IOException;
import java.io.PrintWriter;

import com.stephengware.java.planware.ArgumentMap;
import com.stephengware.java.planware.io.BuildException;
import com.stephengware.java.planware.logic.Expression;

public class Main {
	public static void main(String[] args) {		
		// set domain and problem
		String domainName = "tests/door-domain.pddl";
		String problemName = "tests/door-problem.pddl";
		
		// get domain and problem from args if supplied
		if (args.length > 0) {
			 domainName = args[0];
		}
		if (args.length > 1) {
			problemName = args[1];
		}
		
		Object oDomain = domainName;
		Object oProblem = problemName;
		
		boolean complete = false;
		while (!complete) {
			Bardiche planner = new Bardiche();
			ArgumentMap arguments = planner.makeArguments();
			
			arguments.set(Bardiche.DOMAIN, oDomain);
			arguments.set(Bardiche.PROBLEM, oProblem);
			
			BardicheProblem printproblem = arguments.get(Bardiche.PROBLEM);
			
			// generate part of the narrative
			BardichePlan plan = planner.generate(arguments);
			complete = plan.complete;
			
			if (!complete) {
				// TODO maintain and update steps list
				Expression state = plan.getExecutedPlan(arguments, false).getCurrentState().toExpression();
			
				BardicheProblem problem = arguments.get(Bardiche.PROBLEM);
				BardicheProblem newProblem = new BardicheProblem(
						problem.name,
						problem.domain,
						problem.protagonist,
						problem.universe,
						state,
						problem.goal);
				
				oDomain = problem.domain;
				oProblem = newProblem;
			}
		}
	}
	
	private static void print(ArgumentMap arguments, Object toWrite) {
		try {
			PrintWriter out = new PrintWriter(System.out);
			arguments.get(Bardiche.IO_MANAGER).write(toWrite, out);
			out.flush();
			out.close();
		} catch (BuildException e) {
			System.out.println(toWrite);
		} catch (IOException e) {
			e.printStackTrace();
		}
		System.out.println();
	}
}
